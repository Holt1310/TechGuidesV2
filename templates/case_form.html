{% extends 'layout.html' %}
{% block content %}
<h2>{{ 'Edit Case' if case else 'New Case' }}</h2>
<form method="post">
  {% for field in template.fields %}
  <div class="mb-3">
    <label class="form-label">{{ field.name }}</label>
    {% if field.type == 'textarea' %}
      <textarea name="{{ field.id }}" class="form-control case-field" rows="{{ field.rows or 3 }}" {% if field.required %}required{% endif %}>{{ case.case_data[field.id] if case else '' }}</textarea>
    {% elif field.type == 'select' %}
      <select name="{{ field.id }}" class="form-select case-field" {% if field.required %}required{% endif %}>
        {% for opt in field.options %}
        <option value="{{ opt.value }}" {% if case and case.case_data[field.id]==opt.value %}selected{% endif %}>{{ opt.label }}</option>
        {% endfor %}
      </select>
    {% else %}
      <input type="text" name="{{ field.id }}" class="form-control case-field" value="{{ case.case_data[field.id] if case else '' }}" {% if field.required %}required{% endif %}
             data-field-id="{{ field.id }}">
    {% endif %}
  </div>
  {% endfor %}
  <button class="btn btn-primary" type="submit">Save</button>
</form>
<div id="case-rules" data-rules='{{ template.rules|tojson|safe }}'></div>
<script src="{{ url_for('static', filename='js/case-form.js') }}"></script>
{% endblock %}
