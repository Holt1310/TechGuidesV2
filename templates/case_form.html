{% extends 'layout.html' %}

{% block content %}
<h2>{% if case %}Edit Case{% else %}New Case{% endif %}</h2>
{% if not template %}
  <p>Select a template:</p>
  <ul>
    {% for t in templates %}
      <li><a href="{{ url_for('new_case') }}?template={{ t.id }}">{{ t.name }}</a></li>
    {% endfor %}
  </ul>
{% else %}
<form method="post">
  <input type="hidden" name="template_id" value="{{ template.id }}">
  {% if case %}<input type="hidden" name="case_id" value="{{ case.id }}">{% endif %}
  {% for field in template.fields %}
  <div class="mb-3">
    <label class="form-label">{{ field.name }}</label>
    {% if field.type == 'textarea' %}
      <textarea class="form-control" name="{{ field.id }}">{{ case.data[field.id] if case else '' }}</textarea>
    {% elif field.type == 'select' and field.options %}
      <select class="form-select" name="{{ field.id }}">
        {% for opt in field.options %}
          <option value="{{ opt.value }}" {% if case and case.data[field.id]==opt.value %}selected{% endif %}>{{ opt.label }}</option>
        {% endfor %}
      </select>
    {% else %}
      <input type="text" class="form-control" name="{{ field.id }}" value="{{ case.data[field.id] if case else '' }}">
    {% endif %}
  </div>
  {% endfor %}
  <button type="submit" class="btn btn-primary">Save</button>
</form>
{% endif %}
{% endblock %}
